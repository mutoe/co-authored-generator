<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Co-Author Generator</title>
  <script src="https://cdn.jsdelivr.net/npm/vue"></script>
  <style>
  body {
    font-size: 13px;
    font-family: Yahei;
  }

  code {
    background: #eee;
    padding: 2px 8px;
    display: inline-block;
  }

  input, textarea {
    border: 1px solid #eee;
  }

  textarea {
    width: 80%;
    min-height: 100px;
  }

  #app {
    display: flex;
  }

  details {
    background: #eee;
    padding: 12px;
  }

  .left {
    width: 50%;
    margin: 20px 0;
  }

  .right {
    width: 50%;
  }

  #result {
    border: 1px solid #ddd;
    max-height: 200px;
    overflow: scroll;
  }
  </style>
</head>
<body>

<h1>
  Co-Authored-By ç”Ÿæˆå™¨
</h1>

<details>
  <summary>
    ä»€ä¹ˆæ˜¯
    <a href="https://help.github.com/en/github/committing-changes-to-your-project/creating-a-commit-with-multiple-authors">Co-Auhtored-By</a>ï¼Ÿ
  </summary>

  <p>
    Co-Authored-By å¯ä»¥åœ¨ä½ å’Œå°ä¼™ä¼´pairæ—¶ï¼ŒæŠŠä»–çš„å¤´åƒä¹ŸåŠ å…¥åˆ°commit logä¸­ï¼Œ åšæ³•å°±æ˜¯åœ¨commit messageæœ«å°¾åŠ å…¥è¿™ä¸€è¡Œ
  </p>

  <pre>Co-authored-by: name &lt;name@example.com&gt;</pre>

  <p>
    è¿™ä¸ªå°å·¥å…·å¯ä»¥å¸®ä½ ç®¡ç†pairå°ä¼™ä¼´, ä½¿ç”¨æ—¶åªéœ€ <code>git cc --co mt -m "happy pair!"</code>
  </p>
</details>

<div id="app">
  <div class="left">
    <form>
      <input type="text" v-model="alias" placeholder="alias">
      <input type="text" v-model="username" placeholder="username">
      <input type="text" v-model="email" placeholder="email">
      <button @click="append">æ·»åŠ </button>
    </form>

    <p>æˆ–è€…å¯¼å…¥æ¥è‡ª <code>git config --global alias.cc</code> å·²æœ‰çš„ç‰‡æ®µ</p>
    <textarea type="text" v-model="existAlias"></textarea>
    <p>
      <button @click="parser">å¯¼å…¥</button>
    </p>

    <h2>å°ä¼™ä¼´åˆ—è¡¨</h2>
    <table>
      <thead>
      <tr>
        <th></th>
        <th>Alias</th>
        <th>Username</th>
        <th>Email</th>
        <th></th>
      </tr>
      </thead>
      <tbody>
      <tr v-for="(author, index) in authors" :key="index">
        <td>{{index+1}}</td>
        <td><input type="text" v-model="author.alias"></td>
        <td><input type="text" v-model="author.username"></td>
        <td><input type="text" v-model="author.email"></td>
        <td>
          <button @click="delete(index)">delete</button>
        </td>
      </tr>
      </tbody>
    </table>

  </div>

  <div class="right">
    <p>
      ä½¿ç”¨æ–¹æ³•ï¼šç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®å¤åˆ¶ä»£ç ï¼Œç²˜è´´åœ¨å‘½ä»¤è¡Œä¸­
      <br>
      æ¯æ¬¡æäº¤ä»£ç æ—¶ç”¨ git cc ä»£æ›¿ git commit <code>git cc --co &lt;alias&gt; -m &lt;message&gt;</code>,
    </p>

    <button @click="copy">copy git config setter</button>

    <pre id="result">!co_authored_commit_by() {
  usage="Something wrong!!!";
  while [ "${#}" -gt 0 ]; do
    case "${1}" in
      -m)
        shift;
        message="${1}";
        shift;;
      --co)
        shift;
        co_username="${1}";
        case $co_username in
          <template v-for="author in authors">"{{author.alias}}") co_author_msg="{{author.username}} &lt;{{author.email}}&gt;" ;;
          </template>
          *) echo "No such user, you can select them: {{authors.map(item => item.username).join(', ')}}"; exit 1;;
        esac;
        co_author="Co-authored-by: &quot;${co_author_msg}&quot;\n";
        shift;;
      *)
        shift;;
    esac;
  done;
  if [ -z "${co_author}" ]; then
    echo "${usage}";
    exit 1;
  fi;
  if [ -z "${message}" ]; then
    echo "${usage}";
    exit 1;
  fi;
  co_authored_message="${message}\n${co_author}";
  echo "==== ğŸ‰: Great you did pair today, ğŸ¸ +1s ====\n";
  git commit -m "${co_authored_message}";
};
co_authored_commit_by
  </pre>
  </div>
</div>

<script>
new Vue({
  el: '#app',
  data() {
    return {
      alias: '',
      username: '',
      email: '',
      authors: [],
      existAlias: '',
    }
  },
  methods: {
    append(e) {
      e.preventDefault()
      this.authors.push({
        alias: this.alias,
        username: this.username,
        email: this.email,
      })
      this.alias = ''
      this.username = ''
      this.email = ''
    },
    delete(index) {
      this.authors.splice(index, 1)
    },
    copy() {
      const input = document.createElement('input')
      document.body.appendChild(input)
      let result = document.querySelector('#result').innerHTML
        .replace(/\n/g, '')
        .replace(/&lt;/g, '<')
        .replace(/&gt;/g, '>')
        .replace(/ +/g, ' ')
      result = `git config --global alias.cc '${result}'`
      input.setAttribute('value', result)
      input.select()
      document.execCommand('copy')
      document.body.removeChild(input)
    },
    parser() {
      const matches = this.existAlias.matchAll(/"(\S+)"\) co_author_msg="(\S+) <(\S+)>"/g)
      this.authors.push(...[ ...matches ].map(item => ({
        alias: item[1],
        username: item[2],
        email: item[3],
      })))
      this.existAlias = ''
    },
  },
})
</script>
</body>
</html>
